<div class="analytics-dashboard">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1>ğŸ“Š Analytics Dashboard</h1>
      <div class="header-actions">
        <button 
          *ngIf="isSignedIn" 
          class="btn-refresh" 
          (click)="refreshData()"
          [disabled]="isLoading">
          ğŸ”„ Refresh
        </button>
        <button 
          *ngIf="isSignedIn" 
          class="btn-export" 
          (click)="exportReport()">
          ğŸ“¥ Export Report
        </button>
        <button 
          *ngIf="isSignedIn" 
          class="btn-signout" 
          (click)="signOut()">
          ğŸšª Sign Out
        </button>
      </div>
    </div>
  </div>

  <!-- Sign-in Required -->
  <div *ngIf="!isSignedIn && !isLoading" class="signin-container">
    <div class="signin-card">
      <div class="signin-icon">ğŸ”</div>
      <h2>Sign in to view Analytics</h2>
      <p>Connect your Google account to access real-time analytics data from Google Analytics 4.</p>
      <button class="btn-signin" (click)="signIn()">
        <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google" width="20" height="20">
        Sign in with Google
      </button>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-banner">
    <span>âš ï¸ {{ errorMessage }}</span>
    <button (click)="errorMessage = ''">âœ•</button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading analytics data...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="isSignedIn && !isLoading" class="dashboard-content">
    <!-- Date Range Selector -->
    <div class="controls">
      <div class="date-range-selector">
        <label for="dateRange">ğŸ“… Date Range:</label>
        <select 
          id="dateRange" 
          [(ngModel)]="selectedDateRange" 
          (change)="onDateRangeChange()">
          <option *ngFor="let range of dateRanges" [value]="range.value">
            {{ range.label }}
          </option>
        </select>
      </div>

      <div class="realtime-badge">
        <span class="pulse-dot"></span>
        <span>{{ analyticsData.realtimeUsers }} users online</span>
      </div>
    </div>

    <!-- Overview Cards -->
    <div class="overview-cards">
      <div class="card">
        <div class="card-icon">ğŸ‘ï¸</div>
        <div class="card-content">
          <h3>Page Views</h3>
          <p class="metric">{{ formatNumber(analyticsData.pageViews) }}</p>
        </div>
      </div>

      <div class="card">
        <div class="card-icon">ğŸ‘¥</div>
        <div class="card-content">
          <h3>Unique Visitors</h3>
          <p class="metric">{{ formatNumber(analyticsData.uniqueVisitors) }}</p>
        </div>
      </div>

      <div class="card">
        <div class="card-icon">â±ï¸</div>
        <div class="card-content">
          <h3>Avg. Session Duration</h3>
          <p class="metric">{{ analyticsData.avgSessionDuration }}</p>
        </div>
      </div>

      <div class="card">
        <div class="card-icon">ğŸ“Š</div>
        <div class="card-content">
          <h3>Bounce Rate</h3>
          <p class="metric">{{ analyticsData.bounceRate }}</p>
        </div>
      </div>
    </div>

    <!-- Detailed Analytics -->
    <div class="analytics-grid">
      <!-- Top Pages -->
      <div class="analytics-card">
        <h3>ğŸ“„ Top Pages</h3>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Page</th>
                <th>Views</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let page of analyticsData.topPages">
                <td class="page-path">{{ page.page }}</td>
                <td class="metric-value">{{ formatNumber(page.views) }}</td>
              </tr>
            </tbody>
          </table>
          <p *ngIf="analyticsData.topPages.length === 0" class="no-data">
            No data available
          </p>
        </div>
      </div>

      <!-- Top Events -->
      <div class="analytics-card">
        <h3>âš¡ Top Events</h3>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Event</th>
                <th>Count</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let event of analyticsData.topEvents">
                <td>
                  <span class="event-icon">{{ getEventIcon(event.event) }}</span>
                  {{ event.event }}
                </td>
                <td class="metric-value">{{ formatNumber(event.count) }}</td>
              </tr>
            </tbody>
          </table>
          <p *ngIf="analyticsData.topEvents.length === 0" class="no-data">
            No data available
          </p>
        </div>
      </div>

      <!-- Device Breakdown -->
      <div class="analytics-card">
        <h3>ğŸ“± Device Breakdown</h3>
        <div class="device-list">
          <div *ngFor="let device of analyticsData.deviceBreakdown" class="device-item">
            <div class="device-info">
              <span class="device-icon">{{ getDeviceIcon(device.device) }}</span>
              <span class="device-name">{{ device.device }}</span>
            </div>
            <div class="device-progress">
              <div class="progress-bar">
                <div 
                  class="progress-fill" 
                  [style.width.%]="device.percentage">
                </div>
              </div>
              <span class="percentage">{{ device.percentage }}%</span>
            </div>
          </div>
          <p *ngIf="analyticsData.deviceBreakdown.length === 0" class="no-data">
            No data available
          </p>
        </div>
      </div>

      <!-- Location Data -->
      <div class="analytics-card">
        <h3>ğŸŒ Top Locations</h3>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Country</th>
                <th>Users</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let location of analyticsData.locationData">
                <td>
                  <span class="country-flag">{{ getCountryFlag(location.country) }}</span>
                  {{ location.country }}
                </td>
                <td class="metric-value">{{ formatNumber(location.users) }}</td>
              </tr>
            </tbody>
          </table>
          <p *ngIf="analyticsData.locationData.length === 0" class="no-data">
            No data available
          </p>
        </div>
      </div>
    </div>
  </div>
</div>