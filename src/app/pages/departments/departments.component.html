<div class="departments-container" *transloco="let t; read: 'departments'">
  <!-- Header Section -->
  <section class="departments-header">
    <div class="container">
      <h1>{{ t('header.title') }}</h1>
      <p class="header-description">
        {{ t('header.description') }}
      </p>
      <div class="total-revenue-card">
        <h3>{{ t('header.totalRevenue') }}</h3>
        <div class="total-amount">
          {{ formatCurrency(getTotalCountyRevenue()) }}
        </div>
        <p>{{ t('header.acrossDepartments', { count: departments.length }) }}</p>
      </div>
    </div>
  </section>

  <!-- Departments Grid -->
  <section class="departments-section">
    <div class="container">
      <div class="departments-grid">
        <div
          class="department-card"
          *ngFor="let department of departments; trackBy: trackByDepartmentId"
          [class.active]="selectedDepartment?.id === department.id"
          (click)="selectDepartment(department)"
        >
          <div class="card-header">
            <div class="department-icon">{{ department.icon }}</div>
            <div class="department-info">
              <h3>{{ department.shortName || department.name }}</h3>
              <div class="revenue-info">
                <span class="revenue-amount">{{
                  formatCurrency(department.totalRevenue!)
                }}</span>
                <span class="revenue-percentage"
                  >{{ getPercentageOfTotal(department.totalRevenue!) }}% {{ t('card.ofTotal') }}</span
                >
              </div>
            </div>
          </div>

          <div class="card-body">
            <p class="department-description">{{ department.description }}</p>
            <div class="revenue-streams-count">
              <span class="streams-count">{{
                department.revenueStreams.length
              }}</span>
              <span class="streams-label">{{ t('card.revenueStreams') }}</span>
            </div>
          </div>

          <div class="card-footer">
            <button class="view-details-btn">
              <span>{{
                selectedDepartment?.id === department.id
                  ? t('card.hideDetails')
                  : t('card.viewDetails')
              }}</span>
              <i
                class="arrow"
                [class.rotate]="selectedDepartment?.id === department.id"
                >▼</i
              >
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Department Details Modal/Expanded View -->
  <div
    class="department-details"
    *ngIf="selectedDepartment"
    (click)="closeDetails()"
  >
    <div class="details-card" (click)="$event.stopPropagation()">
      <div class="details-header">
        <div class="header-content">
          <div class="department-icon-large">{{ selectedDepartment.icon }}</div>
          <div class="department-title-section">
            <h2>{{ selectedDepartment.name }}</h2>
            <p class="full-description">{{ selectedDepartment.description }}</p>
          </div>
        </div>
        <button class="close-btn" (click)="closeDetails()">✕</button>
      </div>

      <div class="details-body">
        <div class="revenue-summary">
          <div class="summary-item">
            <span class="summary-label">{{ t('details.totalRevenue') }}</span>
            <span class="summary-value">{{
              formatCurrency(selectedDepartment.totalRevenue!)
            }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">{{ t('details.percentageOfCounty') }}</span>
            <span class="summary-value"
              >{{
                getPercentageOfTotal(selectedDepartment.totalRevenue!)
              }}%</span
            >
          </div>
          <div class="summary-item">
            <span class="summary-label">{{ t('details.revenueStreams') }}</span>
            <span class="summary-value">{{
              selectedDepartment.revenueStreams.length
            }}</span>
          </div>
        </div>

        <div class="revenue-streams-section">
          <h3>{{ t('details.streamsTitle') }}</h3>
          <div class="streams-grid">
            <div
              class="stream-card"
              *ngFor="
                let stream of selectedDepartment.revenueStreams;
                trackBy: trackByStreamName
              "
            >
              <div class="stream-header">
                <h4>{{ stream.name }}</h4>
              </div>
              <div class="stream-body" *ngIf="stream.description">
                <p>{{ stream.description }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics Overview -->
  <section class="statistics-section" *ngIf="!selectedDepartment">
    <div class="container">
      <h2 class="section-title">{{ t('stats.title') }}</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number">{{ departments.length }}</div>
          <div class="stat-label">{{ t('stats.totalDepartments') }}</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{ getTotalRevenueStreams() }}</div>
          <div class="stat-label">{{ t('stats.revenueStreams') }}</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">
            {{ formatCurrency(getAverageRevenue()) }}
          </div>
          <div class="stat-label">{{ t('stats.averageRevenue') }}</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">
            {{ getTopPerformingDepartment().percentage }}%
          </div>
          <div class="stat-label">{{ t('stats.topDepartmentShare') }}</div>
        </div>
      </div>
    </div>
  </section>
</div>